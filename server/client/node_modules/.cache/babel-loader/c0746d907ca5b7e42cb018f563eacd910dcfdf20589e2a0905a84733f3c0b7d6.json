{"ast":null,"code":"import { getUsers } from './users.js';\nimport { handleGet, handlePost, handleDelete, handlePatch } from './api.js';\n\n// Backend API URL - override the default from api.js\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:6790';\nconst POSTS_ENDPOINT = `${API_URL}/posts`;\nconst USERS_ENDPOINT = `${API_URL}/users`;\n\n/**\n * NOTE: You do not need to change this function! \n * If your implementations of getPosts() and getUsers()\n * are working, this function will work just fine.\n * \n * Get all posts with author names added (as opposed to just author ids)\n * @param {number} author (optional) - The author ID to filter posts by.\n * @returns {Promise<Object[]>} - An array of post objects with author names.\n */\nconst getPostsWithAuthorNames = async (authorId = null) => {\n  let posts = await getPosts(authorId);\n  let users = await getUsers();\n  return posts.map(post => {\n    var _user$displayName;\n    const user = users.find(user => user.id === post.authorId);\n    if (!user) {\n      throw new Error(`Post ${post.id} found with uknown author ${post.authorId}`);\n    }\n    return {\n      ...post,\n      authorName: (_user$displayName = user === null || user === void 0 ? void 0 : user.displayName) !== null && _user$displayName !== void 0 ? _user$displayName : 'Unknown Author'\n    };\n  });\n};\n\n/**\n * NOTE: You do not need to change this function! \n * If your implementations of getPost() and getUsers()\n * are working, this function will work just fine.\n * \n * Get a single post with author name added (as opposed to just author id)\n * @param {String} postId - The post to get.\n * @returns {Promise<Object>} - A post object with author name added.\n */\nconst getPostWithAuthorName = async postId => {\n  var _theAuthor$displayNam;\n  let users = await getUsers();\n  let thePost = await getPost(postId);\n  if (!thePost) {\n    throw new Error(`Post ${postId} not found.`);\n  }\n  let theAuthor = users.find(user => user.id === thePost.authorId);\n  if (!theAuthor) {\n    throw new Error(`Post ${thePost.id} has unknown author ${thePost.authorId}`);\n  }\n  thePost.authorName = (_theAuthor$displayNam = theAuthor === null || theAuthor === void 0 ? void 0 : theAuthor.displayName) !== null && _theAuthor$displayNam !== void 0 ? _theAuthor$displayNam : 'Unknown Author';\n  return thePost;\n};\n\n/**\n * NOTE: You do not need to change this function! \n * If your implementations of getPosts() and deletePost()\n * are working, this function will work just fine.\n * \n * Delete all posts by a user. Needed when a user is deleted.\n * @param {String} postId - The post to get.\n * @returns {Promise<Object>} - A post object with author name added.\n */\nconst deletePostsByUser = async userId => {\n  const postsByUser = await getPosts(userId);\n  postsByUser.forEach(async post => {\n    await deletePost(post.id);\n  });\n};\n\n/**\n * Get all posts.\n * If an author is provided, it will return only posts by that author.\n * @param {String} author (optional) - The author ID to filter posts by.\n * @returns {Promise<Object[]>} - An array of post objects.\n */\nconst getPosts = async (authorId = null) => {\n  if (authorId) {\n    // Get posts by a specific user\n    return await handleGet(`${USERS_ENDPOINT}/${authorId}/posts`);\n  }\n  // Get all posts\n  return await handleGet(POSTS_ENDPOINT);\n};\n\n/**\n * Get a post by its ID.\n * @param {String} id - The ID of the post to get.\n * @returns {Promise<Object>} - The post object if found, undefined otherwise\n */\nconst getPost = async id => {\n  const allPosts = await handleGet(POSTS_ENDPOINT);\n  return allPosts.find(post => post.id === id);\n};\n\n/**\n * Create a new (blog) post.\n * @param {Object} postData - The post data to create.\n * @returns {Promise<Object>} - The created post object.\n */\nconst createPost = async postData => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n\n  // Backend automatically adds createdAt and updatedAt\n  const response = await fetch(`${USERS_ENDPOINT}/${postData.authorId}/posts`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(postData)\n  });\n  if (!response.ok) {\n    throw new Error(`Failed to create post: ${response.statusText}`);\n  }\n\n  // Fetch the updated posts list to get the newly created post\n  const posts = await getPosts(postData.authorId);\n  // Return the most recently created post (should be last in array or have latest timestamp)\n  return posts[posts.length - 1];\n};\n\n/**\n * Update a post.\n * @param {String} id - The ID of the post to update.\n * @param {Object} updatedFields - The fields to update.\n * @returns {Promise<Object>} - The updated post object.\n *   Fields not included in the object will not be updated.\n * @throws {Error} - if post not found\n */\nconst updatePost = async (id, updatedFields) => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  if (!jwt) {\n    throw new Error('Not authenticated. Please login first.');\n  }\n\n  // Backend automatically updates updatedAt timestamp\n  const response = await fetch(`${POSTS_ENDPOINT}/${id}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(updatedFields)\n  });\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to update post: ${errorText || response.statusText}`);\n  }\n\n  // Fetch the updated post\n  return await getPost(id);\n};\n\n/**\n * Delete a post.\n * @param {String} id - The ID of the post to delete.\n * @returns {Promise<void>} - A promise that resolves when the post is deleted.\n */\nconst deletePost = async id => {\n  await handleDelete(`${POSTS_ENDPOINT}/${id}`);\n};\nexport { getPostsWithAuthorNames, getPostWithAuthorName, deletePostsByUser, getPosts, getPost, createPost, updatePost, deletePost };","map":{"version":3,"names":["getUsers","handleGet","handlePost","handleDelete","handlePatch","API_URL","process","env","REACT_APP_API_URL","POSTS_ENDPOINT","USERS_ENDPOINT","getPostsWithAuthorNames","authorId","posts","getPosts","users","map","post","_user$displayName","user","find","id","Error","authorName","displayName","getPostWithAuthorName","postId","_theAuthor$displayNam","thePost","getPost","theAuthor","deletePostsByUser","userId","postsByUser","forEach","deletePost","allPosts","createPost","postData","jwt","localStorage","getItem","response","fetch","method","headers","body","JSON","stringify","ok","statusText","length","updatePost","updatedFields","errorText","text"],"sources":["/Users/andyxu/Desktop/fall2025/si679/proj-1-blogtastic-yihaoxu0816/client/src/data/posts.js"],"sourcesContent":["import { getUsers } from './users.js';\nimport { handleGet, handlePost, handleDelete, handlePatch } from './api.js';\n\n// Backend API URL - override the default from api.js\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:6790';\nconst POSTS_ENDPOINT = `${API_URL}/posts`;\nconst USERS_ENDPOINT = `${API_URL}/users`;\n\n/**\n * NOTE: You do not need to change this function! \n * If your implementations of getPosts() and getUsers()\n * are working, this function will work just fine.\n * \n * Get all posts with author names added (as opposed to just author ids)\n * @param {number} author (optional) - The author ID to filter posts by.\n * @returns {Promise<Object[]>} - An array of post objects with author names.\n */\nconst getPostsWithAuthorNames = async (authorId = null) => {\n  let posts = await getPosts(authorId);\n  let users = await getUsers();\n\n  return posts.map((post) => {\n    const user = users.find((user) => user.id === post.authorId);\n    if (!user) {\n      throw new Error(`Post ${post.id} found with uknown author ${post.authorId}`);\n    }\n    return {\n      ...post,\n      authorName: user?.displayName ?? 'Unknown Author'\n    };\n  });\n};\n\n/**\n * NOTE: You do not need to change this function! \n * If your implementations of getPost() and getUsers()\n * are working, this function will work just fine.\n * \n * Get a single post with author name added (as opposed to just author id)\n * @param {String} postId - The post to get.\n * @returns {Promise<Object>} - A post object with author name added.\n */\nconst getPostWithAuthorName = async (postId) => {\n  let users = await getUsers();\n  let thePost = await getPost(postId);\n  \n  if (!thePost) {\n    throw new Error(`Post ${postId} not found.`);\n  }\n\n  let theAuthor = users.find(user => user.id === thePost.authorId);\n  if (!theAuthor) {\n    throw new Error(`Post ${thePost.id} has unknown author ${thePost.authorId}`);\n  }\n\n  thePost.authorName = theAuthor?.displayName ?? 'Unknown Author';\n  return thePost;\n}\n\n/**\n * NOTE: You do not need to change this function! \n * If your implementations of getPosts() and deletePost()\n * are working, this function will work just fine.\n * \n * Delete all posts by a user. Needed when a user is deleted.\n * @param {String} postId - The post to get.\n * @returns {Promise<Object>} - A post object with author name added.\n */\nconst deletePostsByUser = async (userId) => {\n  const postsByUser = await getPosts(userId);\n  postsByUser.forEach(async post => {\n    await deletePost(post.id);\n  })\n}\n\n/**\n * Get all posts.\n * If an author is provided, it will return only posts by that author.\n * @param {String} author (optional) - The author ID to filter posts by.\n * @returns {Promise<Object[]>} - An array of post objects.\n */\nconst getPosts = async (authorId = null) => {\n  if (authorId) {\n    // Get posts by a specific user\n    return await handleGet(`${USERS_ENDPOINT}/${authorId}/posts`);\n  }\n  // Get all posts\n  return await handleGet(POSTS_ENDPOINT);\n};\n\n/**\n * Get a post by its ID.\n * @param {String} id - The ID of the post to get.\n * @returns {Promise<Object>} - The post object if found, undefined otherwise\n */\nconst getPost = async (id) => {\n  const allPosts = await handleGet(POSTS_ENDPOINT);\n  return allPosts.find(post => post.id === id);\n};\n\n/**\n * Create a new (blog) post.\n * @param {Object} postData - The post data to create.\n * @returns {Promise<Object>} - The created post object.\n */\nconst createPost = async (postData) => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  \n  // Backend automatically adds createdAt and updatedAt\n  const response = await fetch(`${USERS_ENDPOINT}/${postData.authorId}/posts`, {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(postData)\n  });\n  \n  if (!response.ok) {\n    throw new Error(`Failed to create post: ${response.statusText}`);\n  }\n  \n  // Fetch the updated posts list to get the newly created post\n  const posts = await getPosts(postData.authorId);\n  // Return the most recently created post (should be last in array or have latest timestamp)\n  return posts[posts.length - 1];\n};\n\n/**\n * Update a post.\n * @param {String} id - The ID of the post to update.\n * @param {Object} updatedFields - The fields to update.\n * @returns {Promise<Object>} - The updated post object.\n *   Fields not included in the object will not be updated.\n * @throws {Error} - if post not found\n */\nconst updatePost = async(id, updatedFields) => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  \n  if (!jwt) {\n    throw new Error('Not authenticated. Please login first.');\n  }\n  \n  // Backend automatically updates updatedAt timestamp\n  const response = await fetch(`${POSTS_ENDPOINT}/${id}`, {\n    method: 'PATCH',\n    headers: { \n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(updatedFields)\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to update post: ${errorText || response.statusText}`);\n  }\n  \n  // Fetch the updated post\n  return await getPost(id);\n};\n\n/**\n * Delete a post.\n * @param {String} id - The ID of the post to delete.\n * @returns {Promise<void>} - A promise that resolves when the post is deleted.\n */\nconst deletePost = async(id) => {\n  await handleDelete(`${POSTS_ENDPOINT}/${id}`);\n};\n\nexport { \n  getPostsWithAuthorNames,\n  getPostWithAuthorName,\n  deletePostsByUser,\n  getPosts, \n  getPost, \n  createPost, \n  updatePost, \n  deletePost, \n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}