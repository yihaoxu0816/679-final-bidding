{"ast":null,"code":"import { deleteRoomsByUser } from \"./rooms.js\";\nimport { handleGet, handlePost, handleDelete, handlePatch } from './api.js';\n\n// Backend API URL - override the default from api.js\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:6790';\nconst USERS_ENDPOINT = `${API_URL}/users`;\nconst AUTH_ENDPOINT = `${API_URL}/auth`;\n\n/**\n * Get a user by their ID.\n * @param {String} id - The ID of the user to get.\n * @returns {Promise<Object>} - The user object or undefined if not found.\n */\nconst getUserById = async id => {\n  return await handleGet(`${USERS_ENDPOINT}/${id}`);\n};\n\n/**\n * Get all users.\n * @returns {Promise<Object[]>} - An array of user objects.\n */\nconst getUsers = async () => {\n  return await handleGet(USERS_ENDPOINT);\n};\n\n/**\n * Register a new user (public endpoint - no authentication required).\n * @param {String} username - The username of the user to register.\n * @param {String} password - The password of the user to register.\n * @returns {Promise<void>} - Resolves when registration is successful.\n */\nconst registerUser = async (username, password) => {\n  const response = await fetch(`${AUTH_ENDPOINT}/register`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to register user: ${errorText || response.statusText}`);\n  }\n};\n\n/**\n * Login a user and store the JWT token.\n * @param {String} username - The username of the user to login.\n * @param {String} password - The password of the user to login.\n * @returns {Promise<Object>} - The user object with JWT token.\n * @throws {Error} - If the user is not found or the password is incorrect.\n */\nconst loginUser = async (username, password) => {\n  const response = await fetch(`${AUTH_ENDPOINT}/login`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(errorText || \"Login failed\");\n  }\n  const user = await response.json();\n\n  // Store JWT token in localStorage\n  if (user.jwt) {\n    localStorage.setItem('jwt', user.jwt);\n    // Store user info (without password)\n    localStorage.setItem('userId', user.id);\n    localStorage.setItem('username', user.username);\n  }\n  return user;\n};\n\n/**\n * Logout a user by clearing stored data.\n */\nconst logoutUser = () => {\n  localStorage.removeItem('jwt');\n  localStorage.removeItem('userId');\n  localStorage.removeItem('username');\n};\n\n/**\n * Get the currently logged in user from localStorage.\n * @returns {Object|null} - User info if logged in, null otherwise.\n */\nconst getCurrentUser = () => {\n  const jwt = localStorage.getItem('jwt');\n  const userId = localStorage.getItem('userId');\n  const username = localStorage.getItem('username');\n  if (jwt && userId) {\n    return {\n      id: userId,\n      username,\n      jwt\n    };\n  }\n  return null;\n};\n\n/**\n * Update a user's information.\n * @param {String} id - The ID of the user to update.\n * @param {Object} updatedFields - The fields to update (e.g., username, password, balance).\n *   Fields not included in the object will not be updated.\n * @returns {Promise<Object>} - The updated user object.\n * @throws {Error} - if user not found\n */\nconst updateUser = async (id, updatedFields) => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  if (!jwt) {\n    throw new Error('Not authenticated. Please login first.');\n  }\n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(updatedFields)\n  });\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to update user: ${errorText || response.statusText}`);\n  }\n  return await response.json();\n};\n\n/**\n * Delete a user and all their associated rooms.\n * @param {String} id - The ID of the user to delete.\n * @returns {Promise<void>} - A promise that resolves when the user is deleted.\n */\nconst deleteUser = async id => {\n  // First delete all rooms created by this user\n  await deleteRoomsByUser(id);\n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'DELETE'\n  });\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to delete user: ${errorText || response.statusText}`);\n  }\n\n  // If deleting self, logout\n  const currentUserId = localStorage.getItem('userId');\n  if (currentUserId === id) {\n    logoutUser();\n  }\n};\nexport { getUserById, getUsers, registerUser, loginUser, logoutUser, getCurrentUser, updateUser, deleteUser };","map":{"version":3,"names":["deleteRoomsByUser","handleGet","handlePost","handleDelete","handlePatch","API_URL","process","env","REACT_APP_API_URL","USERS_ENDPOINT","AUTH_ENDPOINT","getUserById","id","getUsers","registerUser","username","password","response","fetch","method","headers","body","JSON","stringify","ok","errorText","text","Error","statusText","loginUser","user","json","jwt","localStorage","setItem","logoutUser","removeItem","getCurrentUser","getItem","userId","updateUser","updatedFields","deleteUser","currentUserId"],"sources":["/Users/andyxu/Desktop/fall2025/si679/679-final-bidding/client/src/data/users.js"],"sourcesContent":["import { deleteRoomsByUser } from \"./rooms.js\";\nimport { handleGet, handlePost, handleDelete, handlePatch } from './api.js';\n\n// Backend API URL - override the default from api.js\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:6790';\nconst USERS_ENDPOINT = `${API_URL}/users`;\nconst AUTH_ENDPOINT = `${API_URL}/auth`;\n\n/**\n * Get a user by their ID.\n * @param {String} id - The ID of the user to get.\n * @returns {Promise<Object>} - The user object or undefined if not found.\n */\nconst getUserById = async(id) => {\n  return await handleGet(`${USERS_ENDPOINT}/${id}`);\n};\n\n/**\n * Get all users.\n * @returns {Promise<Object[]>} - An array of user objects.\n */\nconst getUsers = async () => {\n  return await handleGet(USERS_ENDPOINT);\n};\n\n/**\n * Register a new user (public endpoint - no authentication required).\n * @param {String} username - The username of the user to register.\n * @param {String} password - The password of the user to register.\n * @returns {Promise<void>} - Resolves when registration is successful.\n */\nconst registerUser = async (username, password) => {\n  const response = await fetch(`${AUTH_ENDPOINT}/register`, {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ username, password })\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to register user: ${errorText || response.statusText}`);\n  }\n};\n\n/**\n * Login a user and store the JWT token.\n * @param {String} username - The username of the user to login.\n * @param {String} password - The password of the user to login.\n * @returns {Promise<Object>} - The user object with JWT token.\n * @throws {Error} - If the user is not found or the password is incorrect.\n */\nconst loginUser = async (username, password) => {\n  const response = await fetch(`${AUTH_ENDPOINT}/login`, {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ username, password })\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(errorText || \"Login failed\");\n  }\n  \n  const user = await response.json();\n  \n  // Store JWT token in localStorage\n  if (user.jwt) {\n    localStorage.setItem('jwt', user.jwt);\n    // Store user info (without password)\n    localStorage.setItem('userId', user.id);\n    localStorage.setItem('username', user.username);\n  }\n  \n  return user;\n};\n\n/**\n * Logout a user by clearing stored data.\n */\nconst logoutUser = () => {\n  localStorage.removeItem('jwt');\n  localStorage.removeItem('userId');\n  localStorage.removeItem('username');\n};\n\n/**\n * Get the currently logged in user from localStorage.\n * @returns {Object|null} - User info if logged in, null otherwise.\n */\nconst getCurrentUser = () => {\n  const jwt = localStorage.getItem('jwt');\n  const userId = localStorage.getItem('userId');\n  const username = localStorage.getItem('username');\n  \n  if (jwt && userId) {\n    return { id: userId, username, jwt };\n  }\n  return null;\n};\n\n/**\n * Update a user's information.\n * @param {String} id - The ID of the user to update.\n * @param {Object} updatedFields - The fields to update (e.g., username, password, balance).\n *   Fields not included in the object will not be updated.\n * @returns {Promise<Object>} - The updated user object.\n * @throws {Error} - if user not found\n */\nconst updateUser = async (id, updatedFields) => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  \n  if (!jwt) {\n    throw new Error('Not authenticated. Please login first.');\n  }\n  \n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'PATCH',\n    headers: { \n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(updatedFields)\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to update user: ${errorText || response.statusText}`);\n  }\n  \n  return await response.json();\n};\n\n/**\n * Delete a user and all their associated rooms.\n * @param {String} id - The ID of the user to delete.\n * @returns {Promise<void>} - A promise that resolves when the user is deleted.\n */\nconst deleteUser = async (id) => {\n  // First delete all rooms created by this user\n  await deleteRoomsByUser(id);\n  \n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'DELETE'\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to delete user: ${errorText || response.statusText}`);\n  }\n  \n  // If deleting self, logout\n  const currentUserId = localStorage.getItem('userId');\n  if (currentUserId === id) {\n    logoutUser();\n  }\n};\n\nexport {\n  getUserById,\n  getUsers,\n  registerUser,\n  loginUser,\n  logoutUser,\n  getCurrentUser,\n  updateUser,\n  deleteUser,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}