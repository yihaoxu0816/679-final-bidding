{"ast":null,"code":"import{deleteRoomsByUser}from\"./rooms.js\";import{handleGet,handlePost,handleDelete,handlePatch}from'./api.js';// Backend API URL - override the default from api.js\nconst API_URL=process.env.REACT_APP_API_URL||'http://localhost:6790';const USERS_ENDPOINT=\"\".concat(API_URL,\"/api/users\");const AUTH_ENDPOINT=\"\".concat(API_URL,\"/api/auth\");/**\n * Get a user by their ID.\n * @param {String} id - The ID of the user to get.\n * @returns {Promise<Object>} - The user object or undefined if not found.\n */const getUserById=async id=>{return await handleGet(\"\".concat(USERS_ENDPOINT,\"/\").concat(id));};/**\n * Get all users.\n * @returns {Promise<Object[]>} - An array of user objects.\n */const getUsers=async()=>{return await handleGet(USERS_ENDPOINT);};/**\n * Register a new user (public endpoint - no authentication required).\n * @param {String} username - The username of the user to register.\n * @param {String} password - The password of the user to register.\n * @returns {Promise<void>} - Resolves when registration is successful.\n */const registerUser=async(username,password)=>{const response=await fetch(\"\".concat(AUTH_ENDPOINT,\"/register\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});if(!response.ok){const errorText=await response.text();throw new Error(\"Failed to register user: \".concat(errorText||response.statusText));}};/**\n * Login a user and store the JWT token.\n * @param {String} username - The username of the user to login.\n * @param {String} password - The password of the user to login.\n * @returns {Promise<Object>} - The user object with JWT token.\n * @throws {Error} - If the user is not found or the password is incorrect.\n */const loginUser=async(username,password)=>{const response=await fetch(\"\".concat(AUTH_ENDPOINT,\"/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});if(!response.ok){const errorText=await response.text();throw new Error(errorText||\"Login failed\");}const user=await response.json();// Store JWT token in localStorage\nif(user.jwt){localStorage.setItem('jwt',user.jwt);// Store user info (without password)\nlocalStorage.setItem('userId',user.id);localStorage.setItem('username',user.username);localStorage.setItem('balance',user.balance.toString());}return user;};/**\n * Logout a user by clearing stored data.\n */const logoutUser=()=>{localStorage.removeItem('jwt');localStorage.removeItem('userId');localStorage.removeItem('username');localStorage.removeItem('balance');};/**\n * Get the currently logged in user from localStorage.\n * @returns {Object|null} - User info if logged in, null otherwise.\n */const getCurrentUser=()=>{const jwt=localStorage.getItem('jwt');const userId=localStorage.getItem('userId');const username=localStorage.getItem('username');const balance=localStorage.getItem('balance');if(jwt&&userId){return{id:userId,username,balance:balance?parseFloat(balance):0,jwt};}return null;};/**\n * Update a user's information.\n * @param {String} id - The ID of the user to update.\n * @param {Object} updatedFields - The fields to update (e.g., username, password, balance).\n *   Fields not included in the object will not be updated.\n * @returns {Promise<Object>} - The updated user object.\n * @throws {Error} - if user not found\n */const updateUser=async(id,updatedFields)=>{// Get JWT token from localStorage\nconst jwt=localStorage.getItem('jwt');if(!jwt){throw new Error('Not authenticated. Please login first.');}const response=await fetch(\"\".concat(USERS_ENDPOINT,\"/\").concat(id),{method:'PATCH',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(jwt)},body:JSON.stringify(updatedFields)});if(!response.ok){const errorText=await response.text();throw new Error(\"Failed to update user: \".concat(errorText||response.statusText));}return await response.json();};/**\n * Delete a user and all their associated rooms.\n * @param {String} id - The ID of the user to delete.\n * @returns {Promise<void>} - A promise that resolves when the user is deleted.\n */const deleteUser=async id=>{// First delete all rooms created by this user\nawait deleteRoomsByUser(id);const response=await fetch(\"\".concat(USERS_ENDPOINT,\"/\").concat(id),{method:'DELETE'});if(!response.ok){const errorText=await response.text();throw new Error(\"Failed to delete user: \".concat(errorText||response.statusText));}// If deleting self, logout\nconst currentUserId=localStorage.getItem('userId');if(currentUserId===id){logoutUser();}};export{getUserById,getUsers,registerUser,loginUser,logoutUser,getCurrentUser,updateUser,deleteUser};","map":{"version":3,"names":["deleteRoomsByUser","handleGet","handlePost","handleDelete","handlePatch","API_URL","process","env","REACT_APP_API_URL","USERS_ENDPOINT","concat","AUTH_ENDPOINT","getUserById","id","getUsers","registerUser","username","password","response","fetch","method","headers","body","JSON","stringify","ok","errorText","text","Error","statusText","loginUser","user","json","jwt","localStorage","setItem","balance","toString","logoutUser","removeItem","getCurrentUser","getItem","userId","parseFloat","updateUser","updatedFields","deleteUser","currentUserId"],"sources":["/Users/andyxu/Desktop/fall2025/si679/679-final-bidding/server/client/src/data/users.js"],"sourcesContent":["import { deleteRoomsByUser } from \"./rooms.js\";\nimport { handleGet, handlePost, handleDelete, handlePatch } from './api.js';\n\n// Backend API URL - override the default from api.js\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:6790';\nconst USERS_ENDPOINT = `${API_URL}/api/users`;\nconst AUTH_ENDPOINT = `${API_URL}/api/auth`;\n\n/**\n * Get a user by their ID.\n * @param {String} id - The ID of the user to get.\n * @returns {Promise<Object>} - The user object or undefined if not found.\n */\nconst getUserById = async(id) => {\n  return await handleGet(`${USERS_ENDPOINT}/${id}`);\n};\n\n/**\n * Get all users.\n * @returns {Promise<Object[]>} - An array of user objects.\n */\nconst getUsers = async () => {\n  return await handleGet(USERS_ENDPOINT);\n};\n\n/**\n * Register a new user (public endpoint - no authentication required).\n * @param {String} username - The username of the user to register.\n * @param {String} password - The password of the user to register.\n * @returns {Promise<void>} - Resolves when registration is successful.\n */\nconst registerUser = async (username, password) => {\n  const response = await fetch(`${AUTH_ENDPOINT}/register`, {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ username, password })\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to register user: ${errorText || response.statusText}`);\n  }\n};\n\n/**\n * Login a user and store the JWT token.\n * @param {String} username - The username of the user to login.\n * @param {String} password - The password of the user to login.\n * @returns {Promise<Object>} - The user object with JWT token.\n * @throws {Error} - If the user is not found or the password is incorrect.\n */\nconst loginUser = async (username, password) => {\n  const response = await fetch(`${AUTH_ENDPOINT}/login`, {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ username, password })\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(errorText || \"Login failed\");\n  }\n  \n  const user = await response.json();\n  \n  // Store JWT token in localStorage\n  if (user.jwt) {\n    localStorage.setItem('jwt', user.jwt);\n    // Store user info (without password)\n    localStorage.setItem('userId', user.id);\n    localStorage.setItem('username', user.username);\n    localStorage.setItem('balance', user.balance.toString());\n  }\n  \n  return user;\n};\n\n/**\n * Logout a user by clearing stored data.\n */\nconst logoutUser = () => {\n  localStorage.removeItem('jwt');\n  localStorage.removeItem('userId');\n  localStorage.removeItem('username');\n  localStorage.removeItem('balance');\n};\n\n/**\n * Get the currently logged in user from localStorage.\n * @returns {Object|null} - User info if logged in, null otherwise.\n */\nconst getCurrentUser = () => {\n  const jwt = localStorage.getItem('jwt');\n  const userId = localStorage.getItem('userId');\n  const username = localStorage.getItem('username');\n  const balance = localStorage.getItem('balance');\n  \n  if (jwt && userId) {\n    return { \n      id: userId, \n      username, \n      balance: balance ? parseFloat(balance) : 0,\n      jwt \n    };\n  }\n  return null;\n};\n\n/**\n * Update a user's information.\n * @param {String} id - The ID of the user to update.\n * @param {Object} updatedFields - The fields to update (e.g., username, password, balance).\n *   Fields not included in the object will not be updated.\n * @returns {Promise<Object>} - The updated user object.\n * @throws {Error} - if user not found\n */\nconst updateUser = async (id, updatedFields) => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  \n  if (!jwt) {\n    throw new Error('Not authenticated. Please login first.');\n  }\n  \n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'PATCH',\n    headers: { \n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(updatedFields)\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to update user: ${errorText || response.statusText}`);\n  }\n  \n  return await response.json();\n};\n\n/**\n * Delete a user and all their associated rooms.\n * @param {String} id - The ID of the user to delete.\n * @returns {Promise<void>} - A promise that resolves when the user is deleted.\n */\nconst deleteUser = async (id) => {\n  // First delete all rooms created by this user\n  await deleteRoomsByUser(id);\n  \n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'DELETE'\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to delete user: ${errorText || response.statusText}`);\n  }\n  \n  // If deleting self, logout\n  const currentUserId = localStorage.getItem('userId');\n  if (currentUserId === id) {\n    logoutUser();\n  }\n};\n\nexport {\n  getUserById,\n  getUsers,\n  registerUser,\n  loginUser,\n  logoutUser,\n  getCurrentUser,\n  updateUser,\n  deleteUser,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}