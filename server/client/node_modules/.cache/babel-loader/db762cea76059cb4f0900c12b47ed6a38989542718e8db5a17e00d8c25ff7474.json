{"ast":null,"code":"import { deletePostsByUser } from \"./posts\";\nimport { handleGet, handlePost, handleDelete, handlePatch } from './api.js';\n\n// Backend API URL - override the default from api.js\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:6790';\nconst USERS_ENDPOINT = `${API_URL}/users`;\nconst AUTH_ENDPOINT = `${API_URL}/auth`;\n\n/**\n * Get a user by their ID.\n * @param {String} id - The ID of the user to get.\n * @returns {Promise<Object>} - The user object or undefined if not found.\n */\nconst getUserById = async id => {\n  return await handleGet(`${USERS_ENDPOINT}/${id}`);\n};\n\n/**\n * Get all users.\n * @returns {Promise<Object[]>} - An array of user objects.\n */\nconst getUsers = async () => {\n  return await handleGet(USERS_ENDPOINT);\n};\n\n/**\n * This function is used to create a new user.\n * @param {String} username - The username of the user to create.\n * @param {String} password - The password of the user to create.\n * @param {String} displayName - The display name of the user to create.\n * @returns {Promise<Object>} - The created user object.\n */\nconst createUser = async (username, password, displayName) => {\n  const userData = {\n    username,\n    password,\n    displayName\n  };\n\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  if (!jwt) {\n    throw new Error('Not authenticated. Please login first.');\n  }\n\n  // Make authenticated request\n  const response = await fetch(USERS_ENDPOINT, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(userData)\n  });\n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to create user: ${errorText || response.statusText}`);\n  }\n\n  // Fetch all users to get the newly created one\n  const users = await getUsers();\n  // Return the most recently created user (last in array)\n  return users[users.length - 1];\n};\n\n/**\n * This function is used to update a user.\n * @param {String} id - The ID of the user to update.\n * @param {Object} updatedFields - The fields to update. \n *   Fields not included in the object will not be updated.\n * @returns {Promise<Object>} - The updated user object.\n * @throws {Error} - if user not found\n\n */\nconst updateUser = async (id, updatedFields) => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n\n  // Make authenticated request\n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'PATCH',\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(updatedFields)\n  });\n  if (!response.ok) {\n    throw new Error(`Failed to update user: ${response.statusText}`);\n  }\n\n  // Fetch the updated user\n  return await getUserById(id);\n};\n\n/**\n * This function is used to delete a user.\n * @param {String} id - The ID of the user to delete.\n * @returns {Promise<void>} - A promise that resolves when the user is deleted.\n */\nconst deleteUser = async id => {\n  await deletePostsByUser(id);\n\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n\n  // Make authenticated request\n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${jwt}`\n    }\n  });\n  if (!response.ok) {\n    throw new Error(`Failed to delete user: ${response.statusText}`);\n  }\n};\n\n/**\n * This function is used to validate a login.\n * @param {String} username - The username of the user to validate.\n * @param {String} password - The password of the user to validate.\n * @returns {Promise<Object>} - The user object.\n * @throws {Error} - If the user is not found or the password is incorrect.\n */\nconst validateLogin = async (username, password) => {\n  // Note: handlePost returns statusText, not JSON\n  // We need to make a custom fetch call for login\n  const response = await fetch(`${AUTH_ENDPOINT}/login`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!response.ok) {\n    const error = await response.text();\n    throw new Error(error || \"Login failed\");\n  }\n  const user = await response.json();\n\n  // Store JWT token in localStorage for authenticated requests\n  if (user.jwt) {\n    localStorage.setItem('jwt', user.jwt);\n  }\n  return user;\n};\nexport { getUserById, getUsers, createUser, updateUser, deleteUser, validateLogin };","map":{"version":3,"names":["deletePostsByUser","handleGet","handlePost","handleDelete","handlePatch","API_URL","process","env","REACT_APP_API_URL","USERS_ENDPOINT","AUTH_ENDPOINT","getUserById","id","getUsers","createUser","username","password","displayName","userData","jwt","localStorage","getItem","Error","response","fetch","method","headers","body","JSON","stringify","ok","errorText","text","statusText","users","length","updateUser","updatedFields","deleteUser","validateLogin","error","user","json","setItem"],"sources":["/Users/andyxu/Desktop/fall2025/si679/proj-1-blogtastic-yihaoxu0816/client/src/data/users.js"],"sourcesContent":["import { deletePostsByUser } from \"./posts\";\nimport { handleGet, handlePost, handleDelete, handlePatch } from './api.js';\n\n// Backend API URL - override the default from api.js\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:6790';\nconst USERS_ENDPOINT = `${API_URL}/users`;\nconst AUTH_ENDPOINT = `${API_URL}/auth`;\n\n/**\n * Get a user by their ID.\n * @param {String} id - The ID of the user to get.\n * @returns {Promise<Object>} - The user object or undefined if not found.\n */\nconst getUserById = async(id) => {\n  return await handleGet(`${USERS_ENDPOINT}/${id}`);\n};\n\n/**\n * Get all users.\n * @returns {Promise<Object[]>} - An array of user objects.\n */\nconst getUsers = async () => {\n  return await handleGet(USERS_ENDPOINT);\n};\n\n/**\n * This function is used to create a new user.\n * @param {String} username - The username of the user to create.\n * @param {String} password - The password of the user to create.\n * @param {String} displayName - The display name of the user to create.\n * @returns {Promise<Object>} - The created user object.\n */\nconst createUser = async (username, password, displayName) => {\n  const userData = { \n    username, \n    password,\n    displayName\n  };\n  \n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  \n  if (!jwt) {\n    throw new Error('Not authenticated. Please login first.');\n  }\n  \n  // Make authenticated request\n  const response = await fetch(USERS_ENDPOINT, {\n    method: 'POST',\n    headers: { \n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(userData)\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    throw new Error(`Failed to create user: ${errorText || response.statusText}`);\n  }\n  \n  // Fetch all users to get the newly created one\n  const users = await getUsers();\n  // Return the most recently created user (last in array)\n  return users[users.length - 1];\n};\n\n/**\n * This function is used to update a user.\n * @param {String} id - The ID of the user to update.\n * @param {Object} updatedFields - The fields to update. \n *   Fields not included in the object will not be updated.\n * @returns {Promise<Object>} - The updated user object.\n * @throws {Error} - if user not found\n\n */\nconst updateUser = async (id, updatedFields) => {\n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  \n  // Make authenticated request\n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'PATCH',\n    headers: { \n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${jwt}`\n    },\n    body: JSON.stringify(updatedFields)\n  });\n  \n  if (!response.ok) {\n    throw new Error(`Failed to update user: ${response.statusText}`);\n  }\n  \n  // Fetch the updated user\n  return await getUserById(id);\n};\n\n/**\n * This function is used to delete a user.\n * @param {String} id - The ID of the user to delete.\n * @returns {Promise<void>} - A promise that resolves when the user is deleted.\n */\nconst deleteUser = async (id) => {\n  await deletePostsByUser(id);\n  \n  // Get JWT token from localStorage\n  const jwt = localStorage.getItem('jwt');\n  \n  // Make authenticated request\n  const response = await fetch(`${USERS_ENDPOINT}/${id}`, {\n    method: 'DELETE',\n    headers: { \n      'Authorization': `Bearer ${jwt}`\n    }\n  });\n  \n  if (!response.ok) {\n    throw new Error(`Failed to delete user: ${response.statusText}`);\n  }\n};\n\n/**\n * This function is used to validate a login.\n * @param {String} username - The username of the user to validate.\n * @param {String} password - The password of the user to validate.\n * @returns {Promise<Object>} - The user object.\n * @throws {Error} - If the user is not found or the password is incorrect.\n */\nconst validateLogin = async (username, password) => {\n  // Note: handlePost returns statusText, not JSON\n  // We need to make a custom fetch call for login\n  const response = await fetch(`${AUTH_ENDPOINT}/login`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ username, password })\n  });\n  \n  if (!response.ok) {\n    const error = await response.text();\n    throw new Error(error || \"Login failed\");\n  }\n  \n  const user = await response.json();\n  \n  // Store JWT token in localStorage for authenticated requests\n  if (user.jwt) {\n    localStorage.setItem('jwt', user.jwt);\n  }\n  \n  return user;\n};\n\nexport {\n  getUserById,\n  getUsers,\n  createUser,\n  updateUser,\n  deleteUser,\n  validateLogin,\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}